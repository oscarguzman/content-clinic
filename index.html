<script>
  const form = document.getElementById('contentForm');
  const responseDiv = document.getElementById('response');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    responseDiv.innerText = 'Generating...';

    const data = {
      topic: form.topic.value,
      tone: form.tone.value,
      platform: form.platform.value
    };

    try {
      const res = await fetch('https://api.allorigins.win/raw?url=https://hook.us2.make.com/72gm5ddedrrduotjw4to8qrwcx2hnwtf', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      const text = await res.text();
      console.log('Raw response:', text);
      
      let parsed;
      try {
        parsed = JSON.parse(text);
      } catch (err) {
        responseDiv.innerText = 'Received invalid JSON. Raw response:\n\n' + text;
        return;
      }

      if (parsed.result) {
        responseDiv.innerText = decodeURIComponent(parsed.result);
      } else {
        responseDiv.innerText = 'Something went wrong. No result returned.';
      }
    } catch (err) {
      console.error(err);
      responseDiv.innerText = 'An error occurred. Please try again.';
    }
  });
</script>
